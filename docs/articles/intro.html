<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to imgrec â€¢ imgrec</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to imgrec">
<meta property="og:description" content="imgrec">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">imgrec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction to imgrec</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cschwem2er/imgrec/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to imgrec</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cschwem2er/imgrec/blob/HEAD/vignettes/intro.Rmd" class="external-link"><code>vignettes/intro.Rmd</code></a></small>
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="imgrec---image-recognition-with-r">imgrec - Image Recognition with R<a class="anchor" aria-label="anchor" href="#imgrec---image-recognition-with-r"></a>
</h2>
<p><em>imgrec</em> provides an interface for image recognition using the
<a href="https://cloud.google.com/vision/" class="external-link">Google Vision API</a>. It
includes functions to convert data for features such as object detection
and optical character recognition to data frames. The package also
includes functions for analyzing image annotations.</p>
</div>
<div class="section level2">
<h2 id="how-to-install">How to Install<a class="anchor" aria-label="anchor" href="#how-to-install"></a>
</h2>
<p>You can download and install the latest development version with the
devtools package by running
<code>devtools::install_github('cschwem2er/imgrec')</code>.</p>
<p>For Windows users installing from github requires proper setup of <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link">Rtools</a>.</p>
<p>The package can also be installed from CRAN by running
<code>install.packages('imgrec')</code>.</p>
</div>
<div class="section level2">
<h2 id="how-to-use">How to Use<a class="anchor" aria-label="anchor" href="#how-to-use"></a>
</h2>
<div class="section level3">
<h3 id="authentification">Authentification<a class="anchor" aria-label="anchor" href="#authentification"></a>
</h3>
<p>Before loading <em>imgrec</em> you first need to initiate your
authentification credentials. You need an API key from a Google Project
with access permission for the Google Vision API. For this, you can
first create a project using the Google Cloud platform. The setup
process is explained in the API <a href="https://cloud.google.com/vision/docs/before-you-begin" class="external-link">documentation</a>.
You will probably need to enable billing, but depending on your feature
selection up to 1000 requests per month are free (see <a href="https://cloud.google.com/vision/pricing" class="external-link">pricing</a>). Next
following the <a href="https://cloud.google.com/docs/authentication/api-keys#creating_an_api_key" class="external-link">instructions</a>
for creating an API key. Finally, the API key needs to be set as
environment variable before using the initialization function
<code><a href="../reference/gvision_init.html">gvision_init()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>gvision_key <span class="op">=</span> <span class="st">"Your Google Vision API key"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cschwem2er/imgrec" class="external-link">imgrec</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/gvision_init.html">gvision_init</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In order to avoid calling <code>Sys.setenv</code>, you can
permanently store the API key in your <code>.Renviron</code>. I
recommend <code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code> to find and edit your
environment file.</p>
</div>
<div class="section level3">
<h3 id="image-annotations">Image annotations<a class="anchor" aria-label="anchor" href="#image-annotations"></a>
</h3>
<p>Google Vision accepts common file types such as JPG, PNG, or BMP.
Images can be passed to several <code>get_annotations</code>, either as
url strings or file paths to local images. In the following example,
<code>get_annotations</code> is used to retrieve annotations for a
poster of the Star Wars movie <a href="https://en.wikipedia.org/wiki/Star_Wars:_The_Force_Awakens" class="external-link">The
Force Awakens</a>.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg" width="250"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sw_image</span> <span class="op">&lt;-</span> <span class="st">'https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg'</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_annotations.html">get_annotations</a></span><span class="op">(</span>images <span class="op">=</span> <span class="va">sw_image</span>, <span class="co"># image character vector</span></span>
<span>                           features <span class="op">=</span> <span class="st">'all'</span>, <span class="co"># request all available features</span></span>
<span>                           max_res <span class="op">=</span> <span class="fl">5</span>, <span class="co"># maximum number of results per feature</span></span>
<span>                           mode <span class="op">=</span> <span class="st">'url'</span><span class="op">)</span> <span class="co"># determine image type</span></span></code></pre></div>
<p>The function returns a response object from the Google Vision API. It
also recognizes if a user passes a character vector with multiple
images. In this case, request batches are created automatically to
reduce the number of required calls to the API.</p>
<p>After retrieving annotations, raw data can be stored in an UTF-8
encoded <a href="https://en.wikipedia.org/wiki/JSON" class="external-link">JSON</a> file:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.json'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/save_json.html">save_json</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">temp_file_path</span><span class="op">)</span></span></code></pre></div>
<p>While some users might prefer to work with raw <code>.json</code>
data, which includes every single detail returned by the API, the
structure is quite complex and deeply nested. To simplify the data,
<code>parse_annotations</code> converts most of the features to data
frames. For each feature, the original identifier of each image is
included as <code>img_id</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">img_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parse_annotations.html">parse_annotations</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="co"># returns list of data frames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">img_data</span><span class="op">)</span> <span class="co"># all available features</span></span></code></pre></div>
<p>Once the features are converted to data frames, other R packages can
be used to analyze the data. For instance, the <code>labels</code> data
frame contains annotations about image content:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">img_labels</span> <span class="op">&lt;-</span> <span class="va">img_data</span><span class="op">$</span><span class="va">labels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">img_labels</span><span class="op">)</span></span></code></pre></div>
<p><em>imgrec</em> also extracts bounding polygons for logos, objects,
faces and landmarks. We can for instance visualize all recognized logos
of the Star Wars movie poster with <a href="https://CRAN.R-project.org/package=magick" class="external-link">magick</a> and <a href="https://CRAN.R-project.org/package=ggplot2" class="external-link">ggplot2</a>:</p>
<p><em>[!!] There is currently a bug when using <code>magick</code> and
<code>ggplot2</code> which leads to upside down annotations. A temporary
work around is to subtract image height (y) values (see code
below).</em></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/magick/" class="external-link">magick</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html" class="external-link">image_read</a></span><span class="op">(</span><span class="va">sw_image</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/image_ggplot.html" class="external-link">image_ggplot</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">img_data</span><span class="op">$</span><span class="va">logos</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xmin <span class="op">=</span> <span class="va">poly_x_min</span>,</span>
<span>      xmax <span class="op">=</span> <span class="va">poly_x_max</span>,</span>
<span>      ymin <span class="op">=</span> <span class="fl">322</span> <span class="op">-</span> <span class="va">poly_y_min</span>,</span>
<span>      ymax <span class="op">=</span> <span class="fl">322</span> <span class="op">-</span> <span class="va">poly_y_max</span></span>
<span>    <span class="op">)</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color <span class="op">=</span> <span class="st">'yellow'</span>,</span>
<span>    fill <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">'dashed'</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">img_data</span><span class="op">$</span><span class="va">logos</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">poly_x_max</span>, y <span class="op">=</span> <span class="fl">322</span> <span class="op">-</span> <span class="va">poly_y_max</span>, label <span class="op">=</span> <span class="va">description</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"yellow"</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p>Please note that for <em>object recognition</em> data, bounding
polygons are relative to image dimensions. Therefore, you need to
multiply them with image width (x) and height (y). These attributes are
not returned by Google Vision, but can for instance be identified with
<code><a href="https://docs.ropensci.org/magick/reference/attributes.html" class="external-link">magick::image_info()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">img_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/attributes.html" class="external-link">image_info</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span> </span>
<span><span class="va">img_info</span></span></code></pre></div>
<p>Additional functions for feature analysis are currently in
development.</p>
</div>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>Please cite imgrec if you use it for publications:</p>
<pre><code>Carsten Schwemmer (2024). imgrec: Image Recognition. R package version 0.1.3.
https://CRAN.R-project.org/package=imgrec</code></pre>
<p>A BibTeX entry for LaTeX users is:</p>
<pre><code>@Manual{,
  title = {imgrec: Image Recognition},
  author = {Carsten Schwemmer},
  year = {2024},
  note = {R package version 0.1.4},
  url = {https://CRAN.R-project.org/package=imgrec},
}</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.carstenschwemmer.com" class="external-link">Carsten Schwemmer</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
