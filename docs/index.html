<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Interface for Image Recognition â€¢ imgrec</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="An Interface for Image Recognition">
<meta property="og:description" content="Provides an interface for image recognition using the 'Google Vision API' &lt;https://cloud.google.com/vision/&gt; .  Converts API data for features such as object detection and optical character recognition to data frames. The package also includes functions for analyzing image annotations.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">imgrec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/intro.html">Introduction to imagerec</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cschwem2er/imgrec">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="imgrec" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#imgrec" class="anchor"></a>imgrec</h1></div>

<div id="image-recognition-with-r" class="section level2">
<h2 class="hasAnchor">
<a href="#image-recognition-with-r" class="anchor"></a>Image Recognition with R</h2>
<p><em>imgrec</em> provides an interface for image recognition using the <a href="https://cloud.google.com/vision/">Google Vision API</a>. It includes functions to convert data for features such as object detection and optical character recognition to data frames. The package also includes functions for analyzing image annotations.</p>
</div>
<div id="how-to-install" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-install" class="anchor"></a>How to Install</h2>
<p>You can download and install the latest development version of imgrec with the devtools package by running <code><a href="https://www.rdocumentation.org/packages/devtools/topics/install_github">devtools::install_github('cschwem2er/imgrec')</a></code>.</p>
<p>For Windows users installing from github requires proper setup of <a href="https://cran.r-project.org/bin/windows/Rtools/">Rtools</a>, for which a tutorial is available <a href="https://github.com/stan-dev/rstan/wiki/Install-Rtools-for-Windows">here</a>.</p>
<p>The package can also be installed from CRAN by running <code><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages('imgrec')</a></code>.</p>
</div>
<div id="how-to-use" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-use" class="anchor"></a>How to Use</h2>
<div id="authentification" class="section level3">
<h3 class="hasAnchor">
<a href="#authentification" class="anchor"></a>Authentification</h3>
<p>Before loading <em>imgrec</em> you first need to initiate your authentification credentials. You need an API key from a Google Project with access permission for the Google Vision API. For this, you can first create a project using the Google Cloud platform. The setup process is explained in the API <a href="https://cloud.google.com/vision/docs/before-you-begin">documentation</a>. You will probably need to enable billing, but depending on your feature selection up to 1000 requests per month are free (see <a href="https://cloud.google.com/vision/pricing">pricing</a>). Next following the <a href="https://cloud.google.com/docs/authentication/api-keys#creating_an_api_key">instructions</a> for creating an API key. Finally, the API key needs to be set as environment variable before using the initialization function <code><a href="reference/gvision_init.html">gvision_init()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.setenv">Sys.setenv</a></span>(<span class="dt">gvision_key =</span> <span class="st">"Your Google Vision API key"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(imgrec)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw"><a href="reference/gvision_init.html">gvision_init</a></span>()</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">#&gt; Succesfully initialized authentification credentials.</span></a></code></pre></div>
<p>In order to avoid calling <code>Sys.setenv</code>, you can permanently store the API key in your <code>.Renviron</code>. I recommend <code><a href="https://usethis.r-lib.org/reference/edit.html">usethis::edit_r_environ()</a></code> to find and edit your environment file.</p>
</div>
<div id="image-annotations" class="section level3">
<h3 class="hasAnchor">
<a href="#image-annotations" class="anchor"></a>Image annotations</h3>
<p>Google Vision accepts common file types such as JPG, PNG, or BMP. Images can be passed to the function <code>get_annotations</code>, either as url strings or file paths to local images. In the following example, <code>get_annotations</code> is used to retrieve annotations for a poster of the Star Wars movie <a href="https://en.wikipedia.org/wiki/Star_Wars:_The_Force_Awakens">The Force Awakens</a>.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg" width="250"></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">sw_image &lt;-<span class="st"> 'https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg'</span></a>
<a class="sourceLine" id="cb3-2" title="2">results &lt;-<span class="st"> </span><span class="kw"><a href="reference/get_annotations.html">get_annotations</a></span>(<span class="dt">images =</span> sw_image, <span class="co"># image character vector</span></a>
<a class="sourceLine" id="cb3-3" title="3">                           <span class="dt">features =</span> <span class="st">'all'</span>, <span class="co"># request all available features</span></a>
<a class="sourceLine" id="cb3-4" title="4">                           <span class="dt">max_res =</span> <span class="dv">5</span>, <span class="co"># maximum number of results per feature</span></a>
<a class="sourceLine" id="cb3-5" title="5">                           <span class="dt">mode =</span> <span class="st">'url'</span>) <span class="co"># determine image type</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">#&gt; [1] "Sending API request(s).."</span></a></code></pre></div>
<p>The function returns a response object from the Google Vision API. It also recognizes if a user passes a character vector with multiple images. In this case, request batches are created automatically to reduce the number of required calls to the API. After retrieving annotations, raw data can be stored in an UTF-8 encoded <a href="https://en.wikipedia.org/wiki/JSON">JSON</a> file:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">temp_file_path &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>(<span class="dt">fileext =</span> <span class="st">'.json'</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw"><a href="reference/save_json.html">save_json</a></span>(results, temp_file_path)</a></code></pre></div>
<p>While some users might prefer to work with raw <code>.json</code> data, which includes every single detail returned by the API, the structure is quite complex and deeply nested. To simplify the data, <code>parse_annotations</code> converts most of the features to data frames. For each feature, the original identifier of each image is included as <code>img_id</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">img_data &lt;-<span class="st"> </span><span class="kw"><a href="reference/parse_annotations.html">parse_annotations</a></span>(results) <span class="co"># returns list of data frames</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(img_data) <span class="co"># all available features</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt;  [1] "labels"            "web_labels"        "web_similar"      </span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt;  [4] "web_match_partial" "web_match_full"    "web_match_pages"  </span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt;  [7] "objects"           "logos"             "full_text"        </span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; [10] "safe_search"       "colors"            "crop_hints"</span></a></code></pre></div>
<p>Once the features are converted to data frames, other R packages can be used to analyze the data. For instance, the <code>labels</code> data frame contains annotations about image content:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">img_labels &lt;-<span class="st"> </span>img_data<span class="op">$</span>labels</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(img_labels)</a></code></pre></div>
<table class="table table">
<thead><tr class="header">
<th align="left">mid</th>
<th align="left">description</th>
<th align="right">score</th>
<th align="right">topicality</th>
<th align="left">img_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">/m/01n5jq</td>
<td align="left">Poster</td>
<td align="right">0.9679052</td>
<td align="right">0.9679052</td>
<td align="left"><a href="https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg" class="uri">https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg</a></td>
</tr>
<tr class="even">
<td align="left">/m/02vxn</td>
<td align="left">Movie</td>
<td align="right">0.9287522</td>
<td align="right">0.9287522</td>
<td align="left"><a href="https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg" class="uri">https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg</a></td>
</tr>
<tr class="odd">
<td align="left">/m/03c31</td>
<td align="left">Graphic design</td>
<td align="right">0.7759998</td>
<td align="right">0.7759998</td>
<td align="left"><a href="https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg" class="uri">https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg</a></td>
</tr>
<tr class="even">
<td align="left">/m/0218rg</td>
<td align="left">Flyer</td>
<td align="right">0.6593872</td>
<td align="right">0.6593872</td>
<td align="left"><a href="https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg" class="uri">https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg</a></td>
</tr>
<tr class="odd">
<td align="left">/m/011s0</td>
<td align="left">Advertising</td>
<td align="right">0.6283476</td>
<td align="right">0.6283476</td>
<td align="left"><a href="https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg" class="uri">https://upload.wikimedia.org/wikipedia/en/a/a2/Star_Wars_The_Force_Awakens_Theatrical_Poster.jpg</a></td>
</tr>
</tbody>
</table>
<p>The package also extracts bounding polygons for logos, objects, faces and landmarks. We can for instance visualize all recognized logos of the Star Wars movie poster with <a href="https://CRAN.R-project.org/package=magick">magick</a> and <a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magick)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">img &lt;-<span class="st"> </span><span class="kw">image_read</span>(sw_image) </a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw">image_ggplot</span>(img) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="st">   </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> img_data<span class="op">$</span>logos, </a>
<a class="sourceLine" id="cb7-7" title="7">          <span class="kw">aes</span>(<span class="dt">xmin =</span> poly_x_min, <span class="dt">xmax =</span> poly_x_max, </a>
<a class="sourceLine" id="cb7-8" title="8">              <span class="dt">ymin =</span> poly_y_min, <span class="dt">ymax =</span> poly_y_max),</a>
<a class="sourceLine" id="cb7-9" title="9">              <span class="dt">color =</span> <span class="st">'yellow'</span>, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">linetype =</span> <span class="st">'dashed'</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">   </span><span class="kw">geom_text</span>(<span class="dt">data =</span> img_data<span class="op">$</span>logos, </a>
<a class="sourceLine" id="cb7-11" title="11">          <span class="kw">aes</span>(<span class="dt">x =</span>poly_x_max, <span class="dt">y =</span> poly_y_max, <span class="dt">label =</span> description),</a>
<a class="sourceLine" id="cb7-12" title="12">              <span class="dt">size =</span> <span class="dv">8</span>, <span class="dt">color =</span> <span class="st">"yellow"</span>, <span class="dt">vjust =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a></code></pre></div>
<p><img src="reference/figures/sw_logo_rec.png" width="300"></p>
<p>Additional functions for feature analysis are currently in development.</p>
</div>
</div>
<div id="citation" class="section level2">
<h2 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h2>
<p>If you use <em>imgrec</em> for your publications please consider citing it:</p>
<pre><code>  Carsten Schwemmer (2019). imgrec: Image recognition with R. R package version 0.1.0.
  https://github.com/cschwem2er/imgrec</code></pre>
<p>A BibTeX entry for LaTeX users is:</p>
<pre><code>  @Manual{,
    title = {imgrec: Image recognition with R},
    author = {Carsten Schwemmer},
    year = {2019},
    note = {R package version 0.1.0},
    url = {https://github.com/cschwem2er/imgrec},
  }</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=imgrec">https://â€‹cloud.r-project.org/â€‹package=imgrec</a>
</li>
<li>Browse source code at <br><a href="https://github.com/cschwem2er/imgrec">https://â€‹github.com/â€‹cschwem2er/â€‹imgrec</a>
</li>
<li>Report a bug at <br><a href="https://github.com/cschwem2er/imgrec/issues">https://â€‹github.com/â€‹cschwem2er/â€‹imgrec/â€‹issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.carstenschwemmer.com">Carsten Schwemmer</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-9084-946X" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID" height="16"></a> </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/cschwem2er/imgrec"><img src="https://travis-ci.org/cschwem2er/imgrec.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/cschwem2er/imgrec"><img src="https://ci.appveyor.com/api/projects/status/github/cschwem2er/imgrec?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a></li>
<li><a href="https://cran.r-project.org/package=imgrec"><img src="https://www.r-pkg.org/badges/version/imgrec" alt="CRAN status"></a></li>
<li><a href="https://cran.rstudio.com/web/packages/imgrec/index.html"><img src="https://cranlogs.r-pkg.org/badges/grand-total/imgrec" alt="CRAN downloads"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.carstenschwemmer.com">Carsten Schwemmer</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
